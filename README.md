# VideoMatting 使用教程（超详细）

> 一款在浏览器中运行的视频色度抠图与 SVG 动画导出工具。无需安装、无需上传，所有处理都在本地进行。

本教程面向完全没有相关背景的用户，从零开始演示如何导入视频、拾取键色、调整抠像效果、管理时间片段、设置背景、并以可循环播放的 SVG 动画形式导出。指南覆盖全部功能与操作细节，保证不遗漏任何功能点。


## 1. 我需要准备什么

- 一台现代浏览器的电脑（推荐 Chrome、Edge、Safari 最新版本）。
- 可用于测试的视频文件（常见 MP4、WebM、MOV 等只要浏览器能播放即可）。
- 不需要安装，不需要服务器，直接打开项目里的 `index.html` 即可使用。
- 设备需要支持 WebGL（绝大多数现代设备都支持）。若不支持，界面会提示，预览将不可用。


## 2. 如何打开工具

1) 下载/克隆本仓库到本地。
2) 用浏览器打开 `index.html` 即可开始使用。
   - 方式一：双击打开。
   - 方式二：拖拽 `index.html` 到浏览器窗口。

所有处理均在浏览器本地完成，视频不会被上传到网络。


## 3. 界面快速认识

打开后，界面主要分为三块：

- 顶部工具栏
  - “选择视频”：点击打开系统文件选择器；也可以把视频文件直接拖拽到中间的大区域。
  - “重置参数”：恢复抠像相关参数到默认值（不会移除你添加的时间片段）。

- 中间舞台与控制区
  - 舞台（中间大区域）：显示视频与抠像预览。透明区域以“棋盘格”呈现，便于识别透明效果。
  - 播放控制条：包含“播放/暂停”按钮、进度条（可拖动）、时间标签（当前/总时长）。
  - 时间轴（“排除区域”）：管理时间片段，用于在某段时间内手动还原原视频的区域（不被抠掉）。

- 右侧侧栏（参数与导出）
  - “键色与参数”：拾取键色以及抠像相关的全部参数（阈值、柔化、溢色抑制、锐化、像素化）。
  - “背景”：选择“透明”或“纯色”，纯色时可自定义颜色。
  - “导出 SVG 动画”：设置帧率、分辨率、编码、质量，进度显示、预览与下载。


## 4. 基础工作流（一步步上手）

1) 导入视频
   - 点击顶部“选择视频”，或将视频文件拖拽到中间的舞台区域。
   - 载入成功后，舞台将显示视频第一帧，底部状态栏会显示视频尺寸与时长。
   - 可用播放控件进行播放/暂停、拖拽进度条进行定位。

2) 选择背景预览模式（可选）
   - 在右侧“背景”面板：
     - 选择“透明”：抠掉的部分显示棋盘格（导出 SVG 也将带透明通道）。
     - 选择“纯色”：在预览与导出时把抠像结果合成为你选定的纯色背景。

3) 拾取键色（必须）
   - 点击“拾取键色”按钮，鼠标进入拾取模式：
     - 方式一：在画面上“单击”取点颜色。
     - 方式二：在画面上“拖拽出一个小矩形”，框选区域取平均色（更稳健）。
   - 松开鼠标后即完成拾取，右侧“键色”色块会显示所选颜色；此时抠像开始生效。
   - 小技巧：选择靠近背景的代表性区域，避免选到主体颜色。

4) 调整抠像参数（增强效果）
   - 阈值：控制与键色相近的像素被抠除的范围。数值越大，抠掉越多；过大可能误伤主体。
   - 柔化：平滑边缘过渡，减少“硬边”与锯齿。
   - 溢色抑制：减少主体中的键色残留（例如绿幕反光），建议适量增加观察肤色与边缘。
   - 锐化：轻量锐化处理，适当提高细节（0~1）。
   - 像素化：预览的“像素块大小”，用于风格化或性能调试（导出时会做匹配处理使观感一致）。

5) 使用“排除区域”（时间轴）提升细节（可选）
   - 作用：在片段范围内，手动涂抹需要“保留原视频”的区域，使其不被抠掉。
   - 添加片段：点击“添加片段”，默认覆盖整段；也可添加多个不同时间片段。
   - 选择片段：点击时间轴上的片段，选中后会以高亮显示，并自动跳转到该片段开头。
   - 移动片段：按住片段主体左右拖动，改变起止时间位置。
   - 调整时长：拖动片段左右两侧的把手改变片段长度。
   - 删除片段：选中后点击“删除片段”。
   - 重置片段：点击片段右上角“重置”，清空该片段的排除绘制。
   - 工具与绘制：
     - 画笔+：在舞台画面上涂抹要保留原视频的区域（使其“不被抠掉”）。
     - 画笔-：擦除前述涂抹（恢复抠像效果）。
     - 笔刷：调节画笔粗细，便于精修边缘。
   - 建议在暂停时精修，也可在播放中定位后暂停再绘制。

6) 导出 SVG 动画
   - 参数设置：
     - 帧率（建议 6–12）：数值越高动画越顺滑，但文件越大、导出越慢。
     - 分辨率：按原视频比例缩放导出尺寸，右侧会显示“实际导出：宽×高”。
     - 帧编码：WebP（支持透明）或 PNG（兼容性更高）。
       - 浏览器不支持 WebP 时会自动回退 PNG。
     - 质量（仅 WebP 生效）：0.40–0.95，值越大质量越高、体积越大。
     - 预览背景图：给导出的 SVG 预览放一张底图（仅用于预览/可嵌入），选择/清除，右侧显示已选文件名。
     - 包含背景：勾选后导出的 SVG 会“内嵌背景”（透明合成在该背景上）。
   - 开始/取消：
     - 点击“开始导出 SVG”启动，进度条显示进度，可随时“取消”。
   - 导出结果：
     - 生成后页面会出现 SVG 预览与“下载链接”。
     - 若你在“预览背景图”选择了图片，预览卡片会以该图片为背景；清除后显示棋盘格。


## 5. 透明与背景的说明（很重要）

- 舞台预览默认使用“棋盘格”表示透明区域，便于判断抠像是否干净。
- 右侧“背景”选择：
  - 透明：导出 SVG 中帧图片保留透明通道，SVG 显示为透明（预览用棋盘格表示）。
  - 纯色：在预览与导出时合成到纯色背景上，导出的 SVG 里即为“带背景的不透明画面”。
- 导出面板的“包含背景”与“预览背景图”：
  - 包含背景：把背景作为 SVG 的一部分一起导出（便于外部直接使用）。
  - 预览背景图：仅作为预览时的对照底图，也可以与“包含背景”配合使用。


## 6. 键色选择小贴士

- 先点击“拾取键色”进入拾取模式：
  - 鼠标移动时会预览取色（小色块提示），也可拖拽框选区域取“平均色”。
- 选纯净的背景色区域，避免包含主体或阴影。框选平均通常比点取更稳健。
- 抠不干净时：
  - 适度增加“阈值”和“柔化”。
  - 使用“溢色抑制”降低背景色反光对主体的影响。
  - 在“排除区域”片段中用“画笔+”把误抠的主体涂回来。


## 7. 时间轴与“排除区域”详解

- 片段（Clip）：一个时间段内的手动修正层。你可以添加多个片段，分别在不同时间段内绘制不同的排除区域。
- 红色覆盖提示：选中片段后，对应的排除掩膜会以红色半透明叠加在画面上，方便校对。
- 规则：
  - 在片段范围内，排除掩膜为“白”的区域恢复为原视频（不受键控影响）。
  - 掩膜为“黑”的区域按抠像正常处理。
- 操作回顾：添加/选择/拖动/缩放/重置/删除片段，配合画笔+/画笔-与笔刷大小。


## 8. 导出 SVG 的原理与兼容性

- 导出会按设定帧率逐帧采样，得到若干帧图片（WebP 或 PNG）。
- SVG 内部使用 SMIL 动画（`<animate>`）在各帧之间切换显示，从而形成循环动画。
- 兼容性：现代浏览器良好；如需在不支持 SMIL 的环境中使用，请先在目标环境做一次兼容性测试。
- 透明与背景：若选择“透明”，单帧图像将保留 alpha；若“包含背景”，SVG 内会包含底层背景，整体不透明。


## 9. 性能与体积建议

- 帧率：6–12 通常足够流畅且文件较小。
- 分辨率：降低分辨率（例如 50%）能显著加快导出并减小体积。
- 编码：WebP 体积更小、支持透明；若目标平台不支持 WebP，可用 PNG。
- 质量：WebP 质量 0.6–0.8 通常是不错的平衡点。
- 片段与绘制：仅在需要的时间段内添加排除片段，避免过多掩膜合成影响性能。


## 10. 常见问题（FAQ）

- Q1：为什么一开始“键色”是空的？
  - 为避免误操作，默认没有键色。需要先点击“拾取键色”，点选或框选画面颜色后才会开始抠像。

- Q2：透明区域为什么不是黑色？
  - 为了直观表达，透明以“棋盘格”呈现。导出为“透明”时，生成的 SVG 也会保留透明通道。

- Q3：视频快到结尾时会提前停止？
  - 播放逻辑已做“结束对齐”处理，会显示到完整时长与最后一帧。如仍遇到个别编码的边缘情况，请尝试拖动进度条到末尾或重新导入视频。

- Q4：导出很慢/文件很大怎么办？
  - 降低“帧率”和“分辨率”，或将“编码”选为 WebP 并适度降低“质量”。

- Q5：我的浏览器不支持 WebP 怎么办？
  - 工具会自动回退为 PNG 编码，功能不受影响，只是体积可能更大。

- Q6：选了“预览背景图”为什么看不到文件名？
  - 导出面板右侧会显示当前选择的文件名；点击“清除”可移除并恢复棋盘格预览。


## 11. 文件结构（关键文件）

- `index.html`：应用入口与页面结构。
- `src/styles.css`：全部样式（浅色现代化风格、卡片化、圆角、棋盘格透明显示等）。
- `src/main.js`：应用逻辑（WebGL 抠像渲染、拾色、时间轴/掩膜绘制、SVG 导出等）。


## 12. 隐私与安全

- 所有操作均在你的浏览器本地进行，视频与图片不会上传到任何服务器。
- 若你在公共电脑上操作，完成后建议刷新页面以释放内存与撤销文件选择。


## 13. 键位与辅助操作（目前）

- 暂无全局快捷键。建议通过按钮与滑杆进行操作。
- 如果你希望增加快捷键（如空格播放/暂停、键盘切换画笔+/− 等），可以提出需求。


## 14. 遇到问题怎么办

- 请记录你的浏览器版本、系统版本、视频格式与分辨率，并尽量描述复现步骤。
- 如果导出/预览异常，尝试：
  - 刷新页面重新导入。
  - 降低分辨率与帧率。
  - 更换浏览器或更新到最新版本。


祝你创作愉快！如果你还有希望新增的功能（如：批量导出、更多背景合成模式、快捷键、暗色主题等），欢迎反馈。
